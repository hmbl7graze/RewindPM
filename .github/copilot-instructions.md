# GitHub Copilot Instructions

## 基本方針

- **応答言語**: すべての応答は日本語で行うこと
- **対象フレームワーク**: .NET 10を使用し、そのベストプラクティスに従うこと
- **アーキテクチャ**: CQRS (Command Query Responsibility Segregation) とイベントソーシングの設計原則を厳守すること

## アーキテクチャガイドライン

### CQRS原則

- **コマンド側 (Write)**: 
  - `RewindPM.Application.Write` プロジェクトでコマンドとコマンドハンドラを実装
  - `RewindPM.Infrastructure.Write` でイベントストアとリポジトリを実装
  - ドメインイベントを発行し、状態変更を記録すること

- **クエリ側 (Read)**:
  - `RewindPM.Application.Read` プロジェクトでクエリとクエリハンドラを実装
  - `RewindPM.Infrastructure.Read` で読み取り専用のリポジトリを実装
  - 最適化されたビューモデルを使用すること

- **プロジェクション**:
  - `RewindPM.Projection` でイベントをリスニングし、読み取りモデルを更新
  - イベントハンドラは冪等性を保つこと

### イベントソーシング原則

- ドメインイベントはイミュータブルであること
- すべての状態変更はイベントとして記録すること
- アグリゲートの再構築はイベントリプレイで行うこと
- イベントストアを唯一の信頼できるデータソースとすること

### ドメイン駆動設計

- `RewindPM.Domain` プロジェクトにビジネスロジックを集約
- アグリゲート、エンティティ、値オブジェクトの境界を尊重すること
- ドメインロジックをインフラストラクチャから分離すること

## .NET 10ベストプラクティス

- **C# 13の機能**: 最新の言語機能を活用すること
- **非同期処理**: `async/await` パターンを適切に使用すること
- **Nullable参照型**: null安全性を確保すること
- **依存性注入**: DIコンテナを使用し、疎結合を維持すること
- **パフォーマンス**: `Span<T>`, `Memory<T>`, `ValueTask<T>` などを適切に活用すること

## テスト要件

### 実装時の必須事項

1. **単体テストの追加**:
   - 新機能やバグ修正には必ず対応するテストを追加すること
   - テストプロジェクトは対応する実装プロジェクトの命名規則に従う (例: `RewindPM.Domain.Test`)

2. **テストの実行**:
   - 実装完了後、`dotnet test` コマンドで全テストを実行すること
   - 既存のテストが壊れていないことを確認すること
   - テストが失敗した場合は必ず修正すること

3. **テストカバレッジ**:
   - 主要なビジネスロジックには十分なテストカバレッジを確保すること
   - 境界値やエッジケースのテストを含めること

### テストの構成

- **ドメイン**: `RewindPM.Domain.Test`
- **コマンド側**: `RewindPM.Application.Write.Test`, `RewindPM.Infrastructure.Write.Test`
- **クエリ側**: `RewindPM.Application.Read.Test`, `RewindPM.Infrastructure.Read.Test`
- **プロジェクション**: `RewindPM.Projection.Test`

## コーディング規約

- **命名規則**: Microsoftの.NET命名ガイドラインに従うこと
- **コードスタイル**: プロジェクトの既存スタイルと一貫性を保つこと
- **コメント**: 複雑なロジックには日本語でコメントを記述すること
- **エラーハンドリング**: 適切な例外処理とバリデーションを実装すること

## 変更を加える際の注意事項

- 既存のアーキテクチャパターンを崩さないこと
- CQRS境界を越えた直接的なデータアクセスは避けること
- イベントスキーマの変更は慎重に行い、バージョニングを考慮すること
- ドメインロジックをアプリケーション層やインフラストラクチャ層に漏らさないこと
